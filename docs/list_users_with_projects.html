{% extends '_partials/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<!-- Display Success Messages -->
{% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- Available Industries -->
<p>Available Industries: {{ industries|join:", " }}</p>

<!-- Search & Filter Form -->
<form method="GET" class="row g-3 mb-4">
  <div class="col-md-4">
    <input type="text" name="name" class="form-control" placeholder="Search by user name..." value="{{ request.GET.name }}">
  </div>
  <div class="col-md-4">
    <select name="industry" class="form-select">
      <option value="">All Industries</option>
      {% for industry in industries %}
        <option value="{{ industry }}" {% if request.GET.industry == industry %}selected{% endif %}>{{ industry }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-4">
    <button type="submit" class="btn btn-outline-primary w-100">Filter</button>
  </div>
</form>

<!-- Heading -->
<h2 class="mb-4 mt-5">User Projects Information</h2>

<!-- Pagination -->
{% if is_paginated %}
<nav>
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page=1{{ request.GET.urlencode|cut:'page=' }}">First</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{{ request.GET.urlencode|cut:'page=' }}">Previous</a>
      </li>
    {% endif %}

    <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

    {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}{{ request.GET.urlencode|cut:'page=' }}">Next</a>
      </li>
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{{ request.GET.urlencode|cut:'page=' }}">Last</a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endif %}

<!-- User Projects Table -->
<table class="table table-bordered table-hover" style="background-color: lavender;">

<thead class="table-light">
    <tr>
      <th>User Name</th>
      <th>User Type</th>
      <th>Industry</th>
      <th>Project Title</th>
      <th>Project Image</th>
      <th>Created At</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for project in user_ideas %}
    <tr onclick="window.location='{% url 'view_user' project.user.id %}'" style="cursor: pointer;">
      <td>{{ project.user.get_full_name }}</td>
      <td>{{ project.user.get_user_type_display }}</td>
      <td>{{ project.get_industry_display }}</td>
      <td>{{ project.title }}</td>
      <td>
        {% if project.image %}
          <img src="{{ project.image.url }}" alt="{{ project.title }}" width="100">
        {% else %}
          No Image
        {% endif %}
      </td>
      <td>{{ project.created_at|date:"M d, Y H:i" }}</td>
      <td>
        {% if project.user.id in my_connections %}
          <form action="{% url 'unfollow_user' project.user.id %}" method="POST" class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm">Unfollow</button>
          </form>
          <a href="{% url 'send_message' project.user.id %}" class="btn btn-outline-secondary btn-sm">Message</a>
        {% else %}
          <form action="{% url 'connect_user' project.user.id %}" method="POST">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-sm">Connect</button>
          </form>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="7">No users with projects found.</td>
    </tr>
    {% endfor %}
  </tbody>
  
</table>

{% endblock %}
