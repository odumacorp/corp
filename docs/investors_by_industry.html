{% extends '_partials/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

<div class="container mt-5">
    <h2 class="mb-4">Investors in Industry: {{ industry_name }}</h2>

    <a href="{% url 'investors' %}" class="btn btn-secondary mb-3">‚Üê Back to All Investors</a>

    <table class="table table-bordered table-striped">
        <thead class="table-light">
            <tr>
                <th>#</th>
                <th>Full Name</th>
                <th>Industry</th>
                <th>Connections</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for investor in investors %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>
                    <a href="{% url 'profile_view' investor.id %}">
                        {{ investor.get_full_name|default:investor.username }}
                    </a>
                </td>
                <td>
                    <a href="{% url 'investors_by_industry' industry_name=investor.userprofile.industry %}">
                        {{ investor.userprofile.industry }}
                    </a>
                </td>
                <td>{{ investor.userprofile.connected_users.count }}</td>
                <td>
                    {% if user != investor %}
                        {% if user.userprofile not in investor.userprofile.connected_users.all %}
                            <form method="POST" action="{% url 'connect_investor' investor.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-primary btn-sm">Connect</button>
                            </form>
                        {% else %}
                            <form method="POST" action="{% url 'connect_investor' investor.id %}" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger btn-sm">Disconnect</button>
                            </form>
                        {% endif %}
                        <form method="POST" action="{% url 'message_investor' investor.id %}" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-info btn-sm">Message</button>
                        </form>
                    {% else %}
                        <span class="text-muted">You</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No investors found in this industry.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
